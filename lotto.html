<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>ë¡œë˜ í˜ì´ì§€ - 1</title>
        <link rel="stylesheet" href="reset.css">
        <link rel="stylesheet" href="lotto.css">
    </head>
    <body>
        <header>
            <h2>ğŸ± ì¡°ìœ¤ì¬ ë¡œë˜</h2>
        </header>
        <div class="main-contents">
            <div class="box-title">
                <h2>ğŸ±ë‚´ ë²ˆí˜¸ ë‹¹ì²¨ í™•ì¸ğŸ±</h2>
            </div>
            <div class="box-purchase">
                <p>êµ¬ì…í•  ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <div>
                    <input id="input-price">
                    <button id="button-purchase">êµ¬ì…</button>
                </div>
            </div>
            <div class="box-list">
                <p>ì´ 0ê°œë¥¼ êµ¬ë§¤í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
                <ul id="lottos"></ul>
            </div>
            <div class="box-check-winnings">
                <p>ì§€ë‚œ ì£¼ ë‹¹ì²¨ë²ˆí˜¸ 6ê°œì™€ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ 1ê°œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <div class="numbers">
                    <div>ë‹¹ì²¨ ë²ˆí˜¸
                        <p>
                            <input class="input-numbers">
                            <input class="input-numbers">
                            <input class="input-numbers">
                            <input class="input-numbers">
                            <input class="input-numbers">
                            <input class="input-numbers">
                        </p>
                    </div>
                    <div style="text-align: right;">ë³´ë„ˆìŠ¤ ë²ˆí˜¸
                        <p>
                            <input class="input-numbers">
                        </p>
                    </div>
                </div>
                <button id="button-result">ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
            </div>
            
        </div>
        <div id="popup">
            <h3 id="button-close">X</h3>
            <h3>ğŸ† ë‹¹ì²¨ í†µê³„ ğŸ†</h3>
            <table id="table-winnings">
                <tr>
                    <th>ì¼ì¹˜ ê°¯ìˆ˜</th>
                    <th>ë‹¹ì²¨ê¸ˆ</th>
                    <th>ë‹¹ì²¨ ê°¯ìˆ˜</th>
                </tr>
                <tr>
                    <td>3ê°œ</td>
                    <td>5,000</td>
                    <td class="winnings-count">nê°œ</td>
                </tr>
                <tr>
                    <td>4ê°œ</td>
                    <td>50,000</td>
                    <td class="winnings-count">nê°œ</td>
                </tr>
                <tr>
                    <td>5ê°œ</td>
                    <td>1,500,000</td>
                    <td class="winnings-count">nê°œ</td>
                </tr>
                <tr>
                    <td>5ê°œ+ë³´ë„ˆìŠ¤ë³¼</td>
                    <td>30,000,000</td>
                    <td class="winnings-count">nê°œ</td>
                </tr>
                <tr>
                    <td>6ê°œ</td>
                    <td>2,000,000,000</td>
                    <td class="winnings-count">nê°œ</td>
                </tr>
            </table>
            <span id="earnings-rate">ë‹¹ì‹ ì˜ ì´ ìˆ˜ìµë¥ ì€ %ì…ë‹ˆë‹¤.</span>
            <button id="button-retry">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
        </div>

        <div id="popup-background"></div>
        
        <footer>
            <span>Copyright 2023, woowacourse</span>
        </footer>

        <script>
            const my_lots = [];
            const button_purchase = document.getElementById("button-purchase");
            const button_result = document.getElementById("button-result");
            const button_close = document.getElementById("button-close");
            const button_retry = document.getElementById("button-retry");
            const popup = document.getElementById("popup");
            const popup_background = document.getElementById("popup-background");
            const lotto_list = document.getElementById("lottos");
            const input_price = document.getElementById("input-price");

            function purchase(){
                const purchase_count = Math.floor(input_price.value / 1000);
                for (let i=0; i<purchase_count; ++i){
                    const lots = draw_lots();
                    add_list(lots);
                }
                input_price.value = "";
            }

            function refresh_count(){
                document.querySelector(".box-list > p").innerText =
                    "ì´ "+lotto_list.childElementCount+"ê°œë¥¼ êµ¬ë§¤í•˜ì˜€ìŠµë‹ˆë‹¤.";
            }

            function refresh_result(prize_counts, earnings_rate){
                const winnings_count_elements = document.getElementsByClassName("winnings-count");
                const earnings_rate_element = document.getElementById("earnings-rate");
                for(let i=0; i<5; ++i){
                    winnings_count_elements[i].innerText = prize_counts[i]+"ê°œ";
                }
                earnings_rate_element.innerText = "ë‹¹ì‹ ì˜ ì´ ìˆ˜ìµë¥ ì€ "+earnings_rate+"%ì…ë‹ˆë‹¤.";
            }
            
            function add_list(lots){
                const li = document.createElement("li");
                my_lots.push(lots);
                li.setAttribute("class", "lotto");
                li.appendChild(document.createElement("span")).innerText = 'ğŸŸï¸';
                li.appendChild(document.createElement("p")).innerText = lots;
                lotto_list.appendChild(li);
                refresh_count();
            }

            function draw_lots(){
                const lots = [];
                const numbers = Array.from({length: 45}, (_, i) => i+1);
                for (let i=0; i<6; ++i){
                    const index = Math.floor(Math.random() * numbers.length);
                    [numbers[index], numbers[numbers.length-1]] = [numbers[numbers.length-1], numbers[index]];
                    lots[i] = numbers.pop();
                }
                return lots;
            }

            function open_result(){
                popup.style.display = "flex";
                popup_background.style.display = "flex";
            }
            
            function close_result(){
                popup.style.display = "none";
                popup_background.style.display = "none";
            }

            function check_winnings(){
                const input_numbers = document.getElementsByClassName("input-numbers");
                const winning_numbers = [];
                for (let i=0; i<6; ++i){
                    winning_numbers[i] = parseInt(input_numbers[i].value);
                }
                const bonus_number = parseInt(input_numbers[6].value);
                const prize_counts = [0,0,0,0,0];
                const prizes = [5000, 50000, 1500000, 30000000, 2000000000];
                my_lots.forEach(lots => {
                    const winning_count = lots.filter(number => winning_numbers.includes(number)).length;
                    switch (winning_count){
                        case 6:
                            ++prize_counts[4];
                            break;
                        case 5:
                            if (lots.includes(bonus_number)) ++prize_counts[3];
                            else ++prize_counts[2];
                            break;
                        case 4:
                            ++prize_counts[1];
                            break;
                        case 3:
                            ++prize_counts[0];
                            break;
                    }
                });

                const earnings = [];
                for (let i=0; i<5; ++i){
                    earnings[i] = prize_counts[i] * prizes[i];
                }

                const total_earnings = earnings.reduce((acc, cur) => {return acc+cur;}, 0);
                const total_cost = (1000*my_lots.length)
                const earnings_rate = (100 * (total_earnings / total_cost - 1)).toFixed(2);
                refresh_result(prize_counts, earnings_rate);
                open_result();
            }

            function retry(){
                my_lots.splice(0, my_lots.length);
                document.getElementById("lottos").replaceChildren();
                refresh_count();
                close_result();
            }

            button_purchase.addEventListener("click", purchase);
            button_result.addEventListener("click", check_winnings);
            button_close.addEventListener("click", close_result);
            button_retry.addEventListener("click", retry);
        </script>
    </body>
</html>
